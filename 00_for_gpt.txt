# WEAV-AI í”„ë¡œì íŠ¸ ì „ì²´ í˜„í™© (2026ë…„ 1ì›” 23ì¼ ê¸°ì¤€)
# GPTê°€ ì´ íŒŒì¼ë§Œìœ¼ë¡œ í”„ë¡œì íŠ¸ ì „ì²´ ìƒí™©ì„ ì™„ë²½í•˜ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ìƒì„¸í•˜ê²Œ ì •ë¦¬

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”
- **í”„ë¡œì íŠ¸ëª…**: WEAV-AI
- **ì„¤ëª…**: Mac Mini + ì™¸ì¥í•˜ë“œ ê¸°ë°˜ í”„ë¡œë•ì…˜ê¸‰ AI ìƒì„± ì„œë¹„ìŠ¤
- **ê¸°ìˆ ìŠ¤íƒ**: React(TypeScript) + Django(DRF) + PostgreSQL + Redis + Celery + MinIO + Nginx
- **ë°°í¬í™˜ê²½**: Docker Compose + Cloudflare Tunnel
- **í˜„ì¬ìƒíƒœ**: âœ… ëª¨ë“  Docker ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™ ì¤‘ (healthy)

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

### ë£¨íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
/Users/sondongbin/Documents/GitHub/WEAV-AI/
â”œâ”€â”€ backend/                    # Django ë°±ì—”ë“œ (Python)
â”œâ”€â”€ infra/                      # ì¸í”„ë¼ ì„¤ì • (Docker, Nginx)
â”œâ”€â”€ src/                        # React í”„ë¡ íŠ¸ì—”ë“œ (TypeScript)
â”œâ”€â”€ Document/                   # ë¬¸ì„œ ë° ê°€ì´ë“œ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json                # í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„±
â”œâ”€â”€ tsconfig.json              # TypeScript ì„¤ì •
â”œâ”€â”€ vite.config.ts             # Vite ë¹Œë“œ ì„¤ì •
â””â”€â”€ README.md
```

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ (React + TypeScript + Vite)

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/                   # ì¸ì¦ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ LoginView.tsx      # ë¡œê·¸ì¸ í™”ë©´
â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx # ë³´í˜¸ëœ ë¼ìš°íŠ¸
â”‚   â”œâ”€â”€ chat/                   # ì±„íŒ…/ìƒì„± ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx      # ì±„íŒ… ì…ë ¥
â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx    # ì±„íŒ… ë©”ì‹œì§€
â”‚   â”‚   â”œâ”€â”€ ChatView.tsx       # ì±„íŒ… ë©”ì¸ ë·°
â”‚   â”‚   â”œâ”€â”€ ModelSelector.tsx  # ëª¨ë¸ ì„ íƒê¸°
â”‚   â”‚   â”œâ”€â”€ VideoCreationStudio.tsx # ë¹„ë””ì˜¤ ìƒì„± ìŠ¤íŠœë””ì˜¤
â”‚   â”‚   â”œâ”€â”€ VideoOptions.tsx   # ë¹„ë””ì˜¤ ì˜µì…˜
â”‚   â”‚   â””â”€â”€ WelcomeScreen.tsx  # ì›°ì»´ í™”ë©´
â”‚   â”œâ”€â”€ gallery/               # ê°¤ëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ MediaGalleryModal.tsx # ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬
â”‚   â”œâ”€â”€ layout/                # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ AppHeader.tsx      # ì•± í—¤ë”
â”‚   â”‚   â””â”€â”€ Sidebar.tsx        # ì‚¬ì´ë“œë°”
â”‚   â”œâ”€â”€ settings/              # ì„¤ì • ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ SettingsModal.tsx  # ì„¤ì • ëª¨ë‹¬
â”‚   â”œâ”€â”€ onboarding/            # ì˜¨ë³´ë”© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ OnboardingModal.tsx # ì˜¨ë³´ë”© ëª¨ë‹¬
â”‚   â””â”€â”€ ui/                    # UI ì»´í¬ë„ŒíŠ¸
â”‚       â””â”€â”€ ErrorBoundary.tsx  # ì—ëŸ¬ ë°”ìš´ë”ë¦¬
â”œâ”€â”€ constants/                 # ìƒìˆ˜ ì •ì˜
â”‚   â”œâ”€â”€ models.ts             # AI ëª¨ë¸ ìƒìˆ˜
â”‚   â”œâ”€â”€ personas.ts           # í˜ë¥´ì†Œë‚˜ ìƒìˆ˜
â”‚   â”œâ”€â”€ prompts.ts            # í”„ë¡¬í”„íŠ¸ ìƒìˆ˜
â”‚   â””â”€â”€ videoModels.ts        # ë¹„ë””ì˜¤ ëª¨ë¸ ìƒìˆ˜
â”œâ”€â”€ contexts/                 # React Context
â”‚   â”œâ”€â”€ AuthContext.tsx       # ì¸ì¦ ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ ChatContext.tsx       # ì±„íŒ… ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ FolderContext.tsx     # í´ë” ì»¨í…ìŠ¤íŠ¸
â”‚   â””â”€â”€ ThemeContext.tsx      # í…Œë§ˆ ì»¨í…ìŠ¤íŠ¸
â”œâ”€â”€ hooks/                    # ì»¤ìŠ¤í…€ í›…
â”‚   â”œâ”€â”€ useAppLogic.ts        # ì•± ë¡œì§ í›…
â”‚   â””â”€â”€ useChat.ts            # ì±„íŒ… í›…
â”œâ”€â”€ services/                 # ì„œë¹„ìŠ¤ ë ˆì´ì–´
â”‚   â”œâ”€â”€ aiService.ts          # AI ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ firebase.ts           # Firebase ì„œë¹„ìŠ¤
â”‚   â””â”€â”€ userService.ts        # ì‚¬ìš©ì ì„œë¹„ìŠ¤
â”œâ”€â”€ types.ts                  # TypeScript íƒ€ì… ì •ì˜
â””â”€â”€ assets/                   # ì •ì  ìì‚°
    â””â”€â”€ sora-logo.png         # Sora ë¡œê³ 
```

### í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± (package.json)
```json
{
  "name": "weav-ai",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "preview": "vite preview"
  },
  "dependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.16",
    "axios": "^1.6.2",
    "eslint": "^8.55.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "firebase": "^10.7.1",
    "postcss": "^8.4.32",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.1",
    "tailwindcss": "^3.4.0",
    "typescript": "^5.2.2",
    "vite": "^5.0.8"
  }
}
```

### ì£¼ìš” í”„ë¡ íŠ¸ì—”ë“œ ê¸°ëŠ¥
- **ì¸ì¦ ì‹œìŠ¤í…œ**: Firebase Auth ê¸°ë°˜ ë¡œê·¸ì¸/íšŒì›ê°€ì…
- **ì±„íŒ… ì¸í„°í˜ì´ìŠ¤**: ì‹¤ì‹œê°„ AI ì±„íŒ… ë° ìƒì„±
- **ë¹„ë””ì˜¤ ìƒì„± ìŠ¤íŠœë””ì˜¤**: Sora/OpenAI ê¸°ë°˜ ë¹„ë””ì˜¤ ìƒì„±
- **ê°¤ëŸ¬ë¦¬ ì‹œìŠ¤í…œ**: ìƒì„±ëœ ë¯¸ë””ì–´ ê´€ë¦¬
- **ì„¤ì • ê´€ë¦¬**: ì‚¬ìš©ì ì„¤ì • ë° í™˜ê²½ì„¤ì •
- **ë°˜ì‘í˜• ë””ìì¸**: Tailwind CSS ê¸°ë°˜ ëª¨ë˜ UI

## ğŸ”§ ë°±ì—”ë“œ (Django + DRF)

### ë°±ì—”ë“œ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
backend/
â”œâ”€â”€ weavai/                    # ë©”ì¸ Django í”„ë¡œì íŠ¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py            # Django ì„¤ì • (í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜)
â”‚   â”œâ”€â”€ urls.py                # ë©”ì¸ URL ì„¤ì •
â”‚   â”œâ”€â”€ wsgi.py                # WSGI ì„¤ì • (Python ê²½ë¡œ ìˆ˜ì •ë¨)
â”‚   â”œâ”€â”€ asgi.py                # ASGI ì„¤ì •
â”‚   â”œâ”€â”€ config_celery.py       # Celery ì„¤ì • (ì›ë˜ celery.pyì˜€ìœ¼ë‚˜ ì´ë¦„ ë³€ê²½)
â”‚   â””â”€â”€ apps/                  # Django ì•±ë“¤
â”‚       â”œâ”€â”€ core/              # ì½”ì–´ ì•± (í—¬ìŠ¤ì²´í¬)
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ urls.py        # /api/v1/health/
â”‚       â”‚   â””â”€â”€ views.py       # HealthCheckView
â”‚       â”œâ”€â”€ jobs/              # AI ì‘ì—… ê´€ë¦¬ ì•±
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ models.py      # Job, Artifact ëª¨ë¸
â”‚       â”‚   â”œâ”€â”€ serializers.py # Job ì‹œë¦¬ì–¼ë¼ì´ì €ë“¤
â”‚       â”‚   â”œâ”€â”€ views.py       # JobViewSet (CRUD API)
â”‚       â”‚   â”œâ”€â”€ urls.py        # URL ë¼ìš°íŒ…
â”‚       â”‚   â”œâ”€â”€ tasks.py       # Celery íƒœìŠ¤í¬ë“¤
â”‚       â”‚   â””â”€â”€ fal_queue.py   # FAL.ai Queue í´ë¼ì´ì–¸íŠ¸
â”‚       â””â”€â”€ storage/           # ìŠ¤í† ë¦¬ì§€ ì•± (MinIO/S3)
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ s3.py          # S3Storage í´ë˜ìŠ¤
â”‚           â””â”€â”€ urls.py        # ìŠ¤í† ë¦¬ì§€ URL (í˜„ì¬ ë¹ˆ ìƒíƒœ)
â”œâ”€â”€ Dockerfile                 # ë°±ì—”ë“œ Docker ì´ë¯¸ì§€
â”œâ”€â”€ entrypoint.sh             # ì»¨í…Œì´ë„ˆ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ requirements.txt          # Python ì˜ì¡´ì„±
â”œâ”€â”€ manage.py                 # Django ê´€ë¦¬ ëª…ë ¹ì–´
â””â”€â”€ setup.sh                  # ì´ˆê¸° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
```

### Django ì„¤ì • (settings.py ì£¼ìš” ë‚´ìš©)
```python
# í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
DEBUG = config('DEBUG', default=False, cast=bool)
SECRET_KEY = config('SECRET_KEY')
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='localhost,testserver', cast=lambda v: [s.strip() for s in v.split(',')])

# ë°ì´í„°ë² ì´ìŠ¤ (PostgreSQL)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('POSTGRES_DB', default='weavai'),
        'USER': config('POSTGRES_USER', default='weavai_user'),
        'PASSWORD': config('POSTGRES_PASSWORD'),
        'HOST': config('POSTGRES_HOST', default='postgres'),
        'PORT': config('POSTGRES_PORT', default='5432'),
    }
}

# Redis ì„¤ì •
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.redis.RedisCache',
        'LOCATION': config('REDIS_URL', default='redis://redis:6379/1'),
    }
}

# Celery ì„¤ì •
CELERY_BROKER_URL = config('CELERY_BROKER_URL', default='redis://redis:6379/0')
CELERY_RESULT_BACKEND = config('CELERY_RESULT_BACKEND', default='redis://redis:6379/0')

# MinIO/S3 ì„¤ì •
AWS_ACCESS_KEY_ID = config('MINIO_ACCESS_KEY')
AWS_SECRET_ACCESS_KEY = config('MINIO_SECRET_KEY')
AWS_S3_ENDPOINT_URL = config('MINIO_ENDPOINT_URL', default='http://minio:9000')
AWS_S3_CUSTOM_DOMAIN = config('MINIO_ENDPOINT_URL', default='http://minio:9000')
AWS_DEFAULT_ACL = 'public-read'
AWS_S3_OBJECT_PARAMETERS = {'CacheControl': 'max-age=86400'}
AWS_LOCATION = config('MINIO_BUCKET', default='weavai-bucket')
AWS_STORAGE_BUCKET_NAME = config('MINIO_BUCKET', default='weavai-bucket')

# FAL.ai ì„¤ì •
FAL_KEY = config('FAL_KEY')
```

### ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë“¤

#### Job ëª¨ë¸ (jobs/models.py)
```python
class Job(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'ëŒ€ê¸°ì¤‘'),
        ('SUBMITTED', 'ì œì¶œë¨'),
        ('IN_PROGRESS', 'ì§„í–‰ì¤‘'),
        ('COMPLETED', 'ì™„ë£Œë¨'),
        ('FAILED', 'ì‹¤íŒ¨í•¨'),
        ('CANCELLED', 'ì·¨ì†Œë¨'),
    ]

    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    provider = models.CharField(max_length=50, choices=[('fal', 'FAL.ai')])
    model_id = models.CharField(max_length=100)
    arguments = models.JSONField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='PENDING')
    store_result = models.BooleanField(default=True)
    error = models.TextField(blank=True, null=True)

    # FAL.ai ê´€ë ¨ í•„ë“œë“¤
    fal_request_id = models.CharField(max_length=100, blank=True, null=True)
    fal_queue_url = models.URLField(blank=True, null=True)
    fal_status_url = models.URLField(blank=True, null=True)

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return f"{self.provider} - {self.model_id} ({self.status})"
```

#### Artifact ëª¨ë¸ (jobs/models.py)
```python
class Artifact(models.Model):
    KIND_CHOICES = [
        ('image', 'ì´ë¯¸ì§€'),
        ('video', 'ë¹„ë””ì˜¤'),
        ('audio', 'ì˜¤ë””ì˜¤'),
        ('text', 'í…ìŠ¤íŠ¸'),
    ]

    job = models.ForeignKey(Job, related_name='artifacts', on_delete=models.CASCADE)
    kind = models.CharField(max_length=20, choices=KIND_CHOICES)
    s3_key = models.CharField(max_length=500)
    presigned_url = models.URLField()
    mime_type = models.CharField(max_length=100)
    size_bytes = models.PositiveIntegerField()

    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"{self.job.id} - {self.kind}"
```

### API ì—”ë“œí¬ì¸íŠ¸ë“¤

#### ì½”ì–´ API (core/urls.py)
- `GET /api/v1/health/` - í—¬ìŠ¤ì²´í¬ (DB, Redis, Django ìƒíƒœ í™•ì¸)

#### ì¡ API (jobs/urls.py)
- `POST /api/v1/jobs/` - ìƒˆ AI ì‘ì—… ìƒì„±
- `GET /api/v1/jobs/` - ì‘ì—… ëª©ë¡ ì¡°íšŒ (í•„í„°ë§ ì§€ì›: ?status=COMPLETED&provider=fal)
- `GET /api/v1/jobs/{id}/` - ì‘ì—… ìƒì„¸ ì¡°íšŒ (ê²°ê³¼ë¬¼ í¬í•¨)

### Celery íƒœìŠ¤í¬ë“¤ (jobs/tasks.py)

#### submit_fal_job
- FAL.ai Queue APIë¥¼ í†µí•´ ì‘ì—… ì œì¶œ
- Job ìƒíƒœë¥¼ SUBMITTEDë¡œ ë³€ê²½
- FAL.ai request_id, queue_url, status_url ì €ì¥

#### poll_fal_job
- FAL.ai ì‘ì—… ìƒíƒœ ì£¼ê¸°ì  í™•ì¸
- ì™„ë£Œ ì‹œ finalize_job í˜¸ì¶œ

#### finalize_job
- FAL.aiì—ì„œ ê²°ê³¼ë¬¼ ë‹¤ìš´ë¡œë“œ
- MinIOì— ì—…ë¡œë“œ
- Artifact ë ˆì½”ë“œ ìƒì„±
- Job ìƒíƒœë¥¼ COMPLETEDë¡œ ë³€ê²½

### FAL.ai Queue í´ë¼ì´ì–¸íŠ¸ (jobs/fal_queue.py)
```python
class FalQueueClient:
    def __init__(self, api_key: str):
        self.api_key = api_key
        self.base_url = "https://queue.fal.run"
        self.headers = {
            "Authorization": f"Key {api_key}",
            "Content-Type": "application/json"
        }

    def submit_job(self, model_id: str, arguments: dict) -> dict:
        """ì‘ì—… ì œì¶œ"""
        url = f"{self.base_url}/{model_id}"
        data = {"input": arguments}
        response = requests.post(url, json=data, headers=self.headers)
        return response.json()

    def get_job_status(self, request_id: str) -> dict:
        """ì‘ì—… ìƒíƒœ ì¡°íšŒ"""
        url = f"{self.base_url}/requests/{request_id}/status"
        response = requests.get(url, headers=self.headers)
        return response.json()

    def get_job_result(self, request_id: str) -> dict:
        """ì‘ì—… ê²°ê³¼ ì¡°íšŒ"""
        url = f"{self.base_url}/requests/{request_id}"
        response = requests.get(url, headers=self.headers)
        return response.json()

    def download_file(self, file_url: str) -> bytes:
        """ê²°ê³¼ë¬¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ"""
        headers = {"Authorization": f"Key {self.api_key}"}
        response = requests.get(file_url, headers=headers)
        return response.content
```

### S3/MinIO ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ (storage/s3.py)
```python
class S3Storage:
    def __init__(self):
        self.s3_client = boto3.client(
            's3',
            endpoint_url=os.getenv('MINIO_ENDPOINT_URL', 'http://minio:9000'),
            aws_access_key_id=os.getenv('MINIO_ACCESS_KEY'),
            aws_secret_access_key=os.getenv('MINIO_SECRET_KEY'),
            region_name='us-east-1',
            use_ssl=False
        )
        self.bucket_name = os.getenv('MINIO_BUCKET', 'weavai-bucket')

    def create_bucket_if_not_exists(self):
        """ë²„í‚· ìƒì„± (ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°)"""
        try:
            self.s3_client.head_bucket(Bucket=self.bucket_name)
        except:
            self.s3_client.create_bucket(Bucket=self.bucket_name)
            # í¼ë¸”ë¦­ ì½ê¸° ì •ì±… ì„¤ì •
            policy = {
                "Version": "2012-10-17",
                "Statement": [
                    {
                        "Effect": "Allow",
                        "Principal": {"AWS": "*"},
                        "Action": "s3:GetObject",
                        "Resource": f"arn:aws:s3:::{self.bucket_name}/*"
                    }
                ]
            }
            self.s3_client.put_bucket_policy(
                Bucket=self.bucket_name,
                Policy=json.dumps(policy)
            )

    def upload_file(self, file_obj, key: str, content_type: str = None) -> str:
        """íŒŒì¼ ì—…ë¡œë“œ"""
        extra_args = {}
        if content_type:
            extra_args['ContentType'] = content_type

        self.s3_client.upload_fileobj(
            file_obj, self.bucket_name, key, ExtraArgs=extra_args
        )
        return key

    def generate_presigned_url(self, key: str, expiration: int = 3600) -> str:
        """í”„ë¦¬ì‚¬ì¸ë“œ URL ìƒì„±"""
        return self.s3_client.generate_presigned_url(
            'get_object',
            Params={'Bucket': self.bucket_name, 'Key': key},
            ExpiresIn=expiration
        )
```

## ğŸ³ ì¸í”„ë¼ (Docker Compose)

### Docker Compose êµ¬ì„± (infra/docker-compose.yml)
```yaml
version: '3.8'

networks:
  weavai_network:
    driver: bridge

volumes:
  postgres_data:
    driver: local
  minio_data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ${MINIO_DATA_DIR:-/tmp/minio-data}

services:
  # PostgreSQL
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-weavai}
      POSTGRES_USER: ${POSTGRES_USER:-weavai_user}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-change_this_password}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-weavai_user} -d ${POSTGRES_DB:-weavai}"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # MinIO
  minio:
    image: minio/minio:latest
    environment:
      MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY:-weavai_admin}
      MINIO_SECRET_KEY: ${MINIO_SECRET_KEY:-change_this_long_random_password}
      MINIO_BROWSER: on
    volumes:
      - minio_data:/data
    ports:
      - "127.0.0.1:9000:9000"  # API í¬íŠ¸
      - "127.0.0.1:9001:9001"  # ì½˜ì†” í¬íŠ¸
    command: server /data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/ready"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Django API
  api:
    build:
      context: ../backend
      dockerfile: Dockerfile
    environment:
      SECRET_KEY: ${SECRET_KEY}
      DEBUG: ${DEBUG:-False}
      ALLOWED_HOSTS: ${ALLOWED_HOSTS:-localhost,testserver}
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      CELERY_BROKER_URL: redis://redis:6379/0
      CELERY_RESULT_BACKEND: redis://redis:6379/0
      MINIO_ENDPOINT_URL: http://minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ACCESS_KEY}
      MINIO_SECRET_KEY: ${MINIO_SECRET_KEY}
      MINIO_BUCKET: ${MINIO_BUCKET:-weavai-bucket}
      FAL_KEY: ${FAL_KEY}
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/health/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Celery Worker
  worker:
    build:
      context: ../backend
      dockerfile: Dockerfile
    environment: # apiì™€ ë™ì¼í•œ í™˜ê²½ë³€ìˆ˜ë“¤
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    command: celery -A weavai worker -l INFO --concurrency=2

  # Nginx
  nginx:
    image: nginx:alpine
    volumes:
      - ./nginx/conf.d/weavai.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "8080:80"
    depends_on:
      api:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### Nginx ì„¤ì • (infra/nginx/conf.d/weavai.conf)
```nginx
upstream api_backend {
    server api:8000;
}

server {
    listen 80;
    server_name localhost;
    client_max_body_size 100m;

    # ê¸°ë³¸ ë³´ì•ˆ í—¤ë”
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # í—¬ìŠ¤ì²´í¬
    location /healthz {
        access_log off;
        return 200 "ok\n";
        add_header Content-Type text/plain;
    }

    # API ë¼ìš°íŒ…
    location /api/ {
        proxy_pass http://api_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        proxy_buffering on;
        proxy_buffer_size 128k;
        proxy_buffers 4 256k;
        proxy_busy_buffers_size 256k;
    }

    # ê¸°ë³¸ ë¦¬ë‹¤ì´ë ‰íŠ¸
    location / {
        return 404 "Not Found\n";
    }
}
```

### í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env)
```bash
# Django ì„¤ì •
SECRET_KEY=your-super-secret-key-here-at-least-50-characters-long
DEBUG=False
ALLOWED_HOSTS=localhost,testserver,weavai.ai,api.weavai.ai

# ë°ì´í„°ë² ì´ìŠ¤
POSTGRES_DB=weavai
POSTGRES_USER=weavai_user
POSTGRES_PASSWORD=change_this_password

# MinIO ìŠ¤í† ë¦¬ì§€
MINIO_DATA_DIR=/Volumes/WEAVAI_2T/minio-data
MINIO_ACCESS_KEY=weavai_admin
MINIO_SECRET_KEY=your-very-long-random-secret-key-at-least-32-characters
MINIO_BUCKET=weavai-bucket
MINIO_ENDPOINT_URL=http://minio:9000

# FAL.ai API
FAL_KEY=your-fal-ai-api-key-here

# ê¸°íƒ€
LOG_LEVEL=INFO
MAX_UPLOAD_SIZE_MB=100
PRESIGNED_URL_EXPIRATION=3600
```

## ğŸ”„ í˜„ì¬ ì‘ë™ ìƒíƒœ (2026-01-23 ê¸°ì¤€)

### Docker ì„œë¹„ìŠ¤ ìƒíƒœ (ëª¨ë‘ healthy)
```
weavai_api        - Up (healthy) - Django Gunicorn ì„œë²„
weavai_worker     - Up (healthy) - Celery ì‘ì—…ì
weavai_nginx      - Up (healthy) - ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
weavai_postgres   - Up (healthy) - PostgreSQL DB
weavai_redis      - Up (healthy) - Redis ìºì‹œ/ë¸Œë¡œì»¤
weavai_minio      - Up (healthy) - MinIO ê°ì²´ ìŠ¤í† ë¦¬ì§€
```

### í…ŒìŠ¤íŠ¸ëœ API ì—”ë“œí¬ì¸íŠ¸
```bash
# 1. Nginx í—¬ìŠ¤ì²´í¬
curl http://localhost:8080/healthz
# ì‘ë‹µ: ok

# 2. Django API í—¬ìŠ¤ì²´í¬
curl http://localhost:8080/api/v1/health/
# ì‘ë‹µ: {
#     "status": "healthy",
#     "timestamp": "2026-01-23T05:30:24.008053+00:00",
#     "version": "1.0.0",
#     "services": {
#         "database": "healthy",
#         "redis": "healthy",
#         "django": "healthy",
#         "celery": "unknown"
#     }
# }

# 3. ì‘ì—… ìƒì„± (FAL_KEY í•„ìš”)
curl -X POST http://localhost:8080/api/v1/jobs/ \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "fal",
    "model_id": "fal-ai/fast-sdxl",
    "arguments": {"prompt": "beautiful sunset over mountains"},
    "store_result": true
  }'

# 4. ì‘ì—… ëª©ë¡ ì¡°íšŒ
curl http://localhost:8080/api/v1/jobs/

# 5. ì‘ì—… ìƒì„¸ ì¡°íšŒ
curl http://localhost:8080/api/v1/jobs/{job_id}/
```

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ ì‘ì—… ëª©ë¡

### 1. MinIO ë²„í‚· ì´ˆê¸°í™”
```bash
cd infra
./scripts/init_minio_bucket.sh
```
- ë²„í‚· ìƒì„± ë° í¼ë¸”ë¦­ ì½ê¸° ì •ì±… ì„¤ì • í•„ìš”

### 2. FAL.ai API í‚¤ ì„¤ì • í™•ì¸
- `.env` íŒŒì¼ì— `FAL_KEY` ì„¤ì • í•„ìš”
- https://fal.ai ì—ì„œ API í‚¤ ë°œê¸‰

### 3. API ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- ì‹¤ì œ AI ì‘ì—… ìƒì„± ë° ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
- Celery ì›Œì»¤ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
- ê²°ê³¼ë¬¼ MinIO ì—…ë¡œë“œ í™•ì¸

### 4. Cloudflare Tunnel ì„¤ì • (ì™¸ë¶€ ì ‘ê·¼ìš©)
```bash
# Cloudflared ì„¤ì¹˜ ë° ì„¤ì •
brew install cloudflared
cloudflared tunnel login
cloudflared tunnel create weavai
cloudflared tunnel route dns weavai weavai.ai
cloudflared tunnel run weavai
```

### 5. í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™
- API ì—”ë“œí¬ì¸íŠ¸ë“¤ê³¼ ì—°ê²°
- ì‹¤ì‹œê°„ ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸
- ìƒì„±ëœ ë¯¸ë””ì–´ í‘œì‹œ

### 6. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
- Celery ì‘ì—… ëª¨ë‹ˆí„°ë§
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë¡œì§
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

## ğŸ” ì£¼ìš” ê¸°ìˆ ì  íŠ¹ì§•

### 1. í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •
- ëª¨ë“  ì„¤ì •ì´ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
- ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ë¶„
- ë³´ì•ˆ ì •ë³´ í•˜ë“œì½”ë”© ë°©ì§€

### 2. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜
- API ì„œë²„, ì›Œì»¤, ìŠ¤í† ë¦¬ì§€ ì™„ì „ ë¶„ë¦¬
- í—¬ìŠ¤ì²´í¬ë¥¼ í†µí•œ ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ê´€ë¦¬
- ë…ë¦½ì ì¸ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥

### 3. ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬
- Celeryë¥¼ í†µí•œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
- FAL.ai Queue API ì—°ë™
- Redisë¥¼ ë¸Œë¡œì»¤ë¡œ ì‚¬ìš©

### 4. ê°ì²´ ìŠ¤í† ë¦¬ì§€ í†µí•©
- MinIOë¥¼ S3 í˜¸í™˜ ìŠ¤í† ë¦¬ì§€ë¡œ ì‚¬ìš©
- ì™¸ì¥í•˜ë“œì— ë°ì´í„° ì €ì¥
- í”„ë¦¬ì‚¬ì¸ë“œ URLë¡œ ì•ˆì „í•œ ì ‘ê·¼

### 5. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- API í‚¤ ì•”í˜¸í™” ì €ì¥
- í”„ë¡ì‹œ í—¤ë” ì„¤ì •
- CORS ë° ë³´ì•ˆ í—¤ë” ì„¤ì •

## ğŸš¨ í•´ê²°ëœ ì£¼ìš” ì´ìŠˆë“¤

### 1. Python ê²½ë¡œ ë¬¸ì œ
- `manage.py`, `wsgi.py`ì—ì„œ `sys.path` ìˆ˜ë™ ì„¤ì •
- Django ì•± ì„í¬íŠ¸ ë¬¸ì œ í•´ê²°

### 2. PostgreSQL ì—°ê²° ë¬¸ì œ
- í™˜ê²½ë³€ìˆ˜ ì´ë¦„ í†µì¼ (`POSTGRES_*`)
- `psycopg2-binary` íŒ¨í‚¤ì§€ ì¶”ê°€

### 3. Nginx ì„¤ì • ì¶©ëŒ
- ê¸°ë³¸ ì„¤ì • íŒŒì¼ ë®ì–´ì“°ê¸°ë¡œ í•´ê²°
- `/healthz` ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ì‘ë™

### 4. Docker í—¬ìŠ¤ì²´í¬
- ëª¨ë“  ì„œë¹„ìŠ¤ì— í—¬ìŠ¤ì²´í¬ ì¶”ê°€
- ì˜ì¡´ì„± ê¸°ë°˜ ì‹œì‘ ìˆœì„œ ì œì–´

## ğŸ“š ì°¸ê³  ë¬¸ì„œë“¤

### í”„ë¡œì íŠ¸ ë¬¸ì„œ
- `README.md` - í”„ë¡œì íŠ¸ ê°œìš”
- `infra/README.md` - ì¸í”„ë¼ ì„¤ì • ê°€ì´ë“œ
- `backend/README.md` - ë°±ì—”ë“œ ê°œë°œ ê°€ì´ë“œ
- `SecretValue_Setting.md` - ë³´ì•ˆ ì„¤ì • ê°€ì´ë“œ

### ì™¸ë¶€ ë¬¸ì„œ
- `Document/Codex Prompting Guide.pdf`
- `Document/GPT-5.2 Prompting Guide.pdf`
- `Document/Video generation with Sora _ OpenAI API.pdf`

---

## ğŸ¯ í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœ ìš”ì•½

âœ… **ì™„ë£Œëœ ì‘ì—…ë“¤:**
- í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸ êµ¬ì¡° ë° ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- Django ë°±ì—”ë“œ API ì„œë²„ êµ¬ì¶•
- PostgreSQL + Redis + MinIO ì¸í”„ë¼ êµ¬ì„±
- Docker Composeë¥¼ í†µí•œ ì»¨í…Œì´ë„ˆí™”
- FAL.ai Queue API ì—°ë™
- Celery ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬
- Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
- ëª¨ë“  ì„œë¹„ìŠ¤ í—¬ìŠ¤ì²´í¬ ë° ëª¨ë‹ˆí„°ë§

ğŸ”„ **ì§„í–‰ ì¤‘ì¸ ì‘ì—…ë“¤:**
- MinIO ë²„í‚· ì´ˆê¸°í™”
- FAL.ai API í‚¤ ì„¤ì •
- API ê¸°ëŠ¥ ì¢…í•© í…ŒìŠ¤íŠ¸

â³ **ë‹¤ìŒ ë‹¨ê³„ ì‘ì—…ë“¤:**
- Cloudflare Tunnelì„ í†µí•œ ì™¸ë¶€ ì ‘ê·¼ ì„¤ì •
- í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì™„ì „ ì—°ë™
- í”„ë¡œë•ì…˜ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§
- ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ ì™„ì„±

ì´ íŒŒì¼ì„ í†µí•´ GPTëŠ” í”„ë¡œì íŠ¸ì˜ ì „ì²´ì ì¸ êµ¬ì¡°, í˜„ì¬ ìƒíƒœ, ê·¸ë¦¬ê³  ë‹¤ìŒ ë‹¨ê³„ë“¤ì„ ì™„ë²½í•˜ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.